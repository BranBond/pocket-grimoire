{% embed '../includes/details.twig' with {
    open: true,
    summary: 'Setup',
    id: 'setup'
} %}
    {% block body %}
    <ul class="button-list">
        <li><button type="button" class="button" id="select-edition" data-dialog="#edition-list">Select Edition</button></li>
        <li><button type="button" class="button" id="select-characters" data-dialog="#character-select" disabled>Select Characters</button></li>
        <li><button type="button" class="button" id="qr-code-button" data-dialog="#qr-code-dialog" disabled>Character Sheet</button></li>
        <li><button type="button" class="button" id="clear-cache-button" data-dialog="#clear-cache">Clear Cache</button></li>
    </ul>
    {% endblock %}
{% endembed %}

{% embed '../includes/dialog.twig' with {
    id: 'edition-list',
    background: 'blur',
    title: 'Select Edition'
} %}
    {% block body %}

    <form id="select-edition-form">

        <ul class="no-list mb-4">
            <li>
                <label for="edition-tb">
                    <input type="radio" name="edition" value="tb" id="edition-tb" required>
                    Trouble Brewing
                </label>
            </li>
            <li>
                <label for="edition-bmr">
                    <input type="radio" name="edition" value="bmr" id="edition-bmr">
                    Bad Moon Rising
                </label>
            </li>
            <li>
                <label for="edition-snv">
                    <input type="radio" name="edition" value="snv" id="edition-snv">
                    Sects and Violets
                </label>
            </li>
            <li>
                <label for="edition-custom">
                    <input type="radio" name="edition" value="custom" id="edition-custom">
                    Custom Script
                </label>
            </li>
        </ul>

        <p id="custom-script-upload" hidden>
            <label for="custom-script" class="sr-only">Upload a custom script</label>
            {{ forms.file({
                name: "custom-script",
                id: "custom-script",
                accept: "application/json",
                attributes: {
                    "data-invalid-script": "The script format has not been recognised"
                }
            }) }}
        </p>

        <p><button type="submit" class="button">Select</button></p>

    </form>
    {% endblock %}
{% endembed %}

{% embed '../includes/dialog.twig' with {
    id: 'character-select',
    background: 'blur',
    title: 'Select Characters'
} %}
    {% block body %}
    <form id="player-select">

        <div class="character-select__players">
            <label for="player-count" class="character-select__label">Number of players</label>
            {# TODO: travellers, so that the max can go up to 20 again #}
            <input type="range" min="5" max="15" step="1" value="7" name="player-count" id="player-count" class="character-select__range">
            <output id="player-count-output" class="character-select__output">7</output>
        </div>

        <div class="mb-4">
            {{ forms.toggle({
                name: 'toggle-abilities',
                id: 'toggle-abilities',
                checked: true
            }) }}
            <label for="toggle-abilities">Show character abilities</label>
        </div>

        <p><button type="button" class="button" id="player-select-random">Highlight random</button></p>

        {% set teams = {
            townsfolk: 'Townsfolk',
            outsider: 'Outsiders',
            minion: 'Minions',
            demon: 'Demons'
        } %}
        {% for team, name in teams %}
        <fieldset class="sidebar character-select__group" data-team="{{ team }}">
            <legend class="sr-only">{{ name }}</legend>
            <div class="sidebar__side character-select__score">
                <div class="sidebar__side-content character-select__heading">
                    <div class="character-select__title" aria-hidden="true">{{ name }}</div>
                    <div class="character-select__score-box">
                        <span class="js--character-select--count">0</span>-<span class="js--character-select--total"></span>
                    </div>
                </div>
            </div>
            <div class="sidebar__body">
                <div class="character-select__characters js--character-select--list"></div>
            </div>
        </fieldset>
        {% endfor %}

        <button type="submit" class="button">Draw Characters</button>

    </form>
    {% endblock %}
{% endembed %}

{% embed '../includes/dialog.twig' with {
    id: 'character-choice',
    background: 'hide',
    title: 'Select Your Character',
    hideClickBackground: false
} %}
    {% block body %}
    <p>Tap one of the lit tokens to choose your character. Darker ones have already been chosen.</p>
    <div id="character-choice-wrapper" class="slot slot--3">
    </div>
    {% endblock %}
{% endembed %}

<template id="character-choice-template">
    <div>
        <button type="button" data-id="" class="character-choice">
            <span class="character">
                <span class="character__unknown js--character-choice--number"></span>
            </span>
        </button>
    </div>
</template>

{% embed '../includes/dialog.twig' with {
    id: 'character-decision',
    background: 'hide',
    title: 'Remember Your Character'
} %}
    {% block body %}
    <div id="character-decision-wrapper" class="mb-4"></div>
    <p id="character-decision-ability"></p>
    <p><button type="button" class="button" data-dialog-hide>Return to Character Select</button></p>
    {% endblock %}
{% endembed %}

<template id="character-select-template">
    <label class="character-select__character js--character-select--label" for="">
        <input type="checkbox" name="character" value="" class="sr-only character-select__input js--character-select--input">
        <img src="" alt="" aria-hidden="true" class="character-select__part character-select__part--image js--character-select--image" loading="lazy">
        <span class="character-select__part character-select__part--name js--character-select--name"></span>
        <span class="character-select__part character-select__part--ability js--character-select--ability"></span>
    </label>
</template>

{% embed '../includes/dialog.twig' with {
    id: 'qr-code-dialog',
    background: 'hide',
    title: 'Character sheet'
} %}
    {% block body %}
        <p>Scan this QR code to see the character sheet.</p>
        <a href="" target="_blank" rel="noopener noreferrer" id="qr-code-link">
            <span id="qr-code"></span>
        </a>

        <p class="mt-4" id="include-groups">Include:</p>
        <div class="slot slot--2">
            <div>
                {{ forms.toggle({
                    name: 'include-travellers',
                    id: 'include-travellers',
                    checked: true,
                    attributes: {
                        'aria-describedby': 'include-groups'
                    }
                }) }}
                <label for="include-travellers">Travellers</label>
            </div>
            <div>
                {{ forms.toggle({
                    name: 'include-fabled',
                    id: 'include-fabled',
                    checked: true,
                    attributes: {
                        'aria-describedby': 'include-groups'
                    }
                }) }}
                <label for="include-fabled">Fabled</label>
            </div>
        </div>
    {% endblock %}
{% endembed %}

{% embed '../includes/dialog.twig' with {
    id: 'clear-cache',
    background: 'blur',
    title: 'Clear Cache'
} %}
    {% block body %}
        <form id="cache-form">

            <p>
                {{ forms.toggle({
                    name: 'clear-all',
                    id: 'clear-all',
                    checked: true
                }) }}
                <label for="clear-all">Clear everything</label>
                <small class="d-block">Turning this off will allow inividual parts of the cache to be cleared.</small>
            </p>

            <ul id="clear-individual" class="no-list mb-4 p-2 bd-dark" hidden>
                {% set clears = [
                    {
                        value: 'lookup',
                        label: 'Clear data',
                        note: 'The data for the jinxes, team breakdown, and character information.'
                    },
                    {
                        value: 'characters',
                        label: 'Clear edition',
                        note: 'The edition, or script, that\'s been selected and loaded.'
                    },
                    {
                        value: 'tokens',
                        label: 'Clear tokens',
                        note: 'The position of the tokens in the grimoire.'
                    },
                    {
                        value: 'inputs',
                        label: 'Clear inputs',
                        note: 'User settings for this website.'
                    },
                    {
                        value: 'details',
                        label: 'Clear open/closed',
                        note: 'Which sections are open or closed.'
                    },
                    {
                        value: 'height',
                        label: 'Clear pad height',
                        note: 'The height of the pad in the grimoire.'
                    },
                ] %}
                {% for clear in clears %}
                    <li>
                        {{ forms.toggle({
                            name: 'clear',
                            id: 'clear-' ~ clear.value,
                            value: clear.value,
                            checked: true
                        }) }}
                        <label for="clear-{{ clear.value }}">{{ clear.label }}</label>
                        <small class="d-block">{{ clear.note }}</small>
                    </li>
                {% endfor %}
            </ul>

            <p>
                {{ forms.toggle({
                    name: 'clear-refresh',
                    id: 'clear-refresh',
                    checked: true
                }) }}
                <label for="clear-refresh">Refresh afterwards</label>
                <small class="d-block">Refreshing will load in new data for anything that's been cleared.</small>
            </p>

            <p id="token-warning"><small><strong>Warning:</strong> any tokens that have been placed on the grimoire will be forgotten.</small></p>
            <p><button type="submit" class="button">Clear Cache</button></p>

        </form>
    {% endblock %}
{% endembed %}
